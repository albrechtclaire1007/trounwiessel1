<!DOCTYPE html>
<html lang="lb">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Setz d'Buschtawen an d√©i richteg Reiefolleg</title>
  <style>
    @font-face{
      font-family:'Schoulschreft';
      src:url('https://github.com/albrechtclaire1007/schoulschreft/raw/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
    }
    body{margin:0;padding:0;font-family:'Schoulschreft',Arial,sans-serif;background:#fff;min-height:100vh}
    .header{background:#1c2d4f;color:#fff;text-align:center;padding:20px;font-size:28px;font-weight:bold;margin-bottom:30px}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .word-container{max-width:500px;margin:0 auto;background:#fff;border:3px solid #f2ac3b;border-radius:15px;padding:40px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.1)}
    .progress-bar{background:#f0f0f0;height:8px;border-radius:4px;margin-bottom:30px;overflow:hidden}
    .progress-fill{background:linear-gradient(90deg,#1c2d4f,#f2ac3b);height:100%;transition:width .5s ease;border-radius:4px}
    .word-counter{font-size:18px;color:#1c2d4f;margin-bottom:20px;font-weight:bold}
    .image-container{position:relative;margin-bottom:20px}
    .word-image{width:120px;height:120px;object-fit:cover;border:4px solid #f2ac3b;border-radius:10px;margin-bottom:15px}
    .audio-btn{position:absolute;top:10px;left:10px;width:40px;height:40px;background:#f2ac3b;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#1c2d4f;transition:.3s all}
    .audio-btn:hover{background:#e09a2f;transform:scale(1.1)}
    .speaker-icon{width:20px;height:20px;fill:#1c2d4f}
    .scrambled-letters,.answer-boxes{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;touch-action:manipulation}
    .scrambled-letters{margin:20px 0}
    .letter-box{width:45px;height:45px;background:#fff;border:3px solid #1c2d4f;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;color:#1c2d4f;cursor:grab;user-select:none;transition:.3s all}
    .letter-box:hover{background:#f0f8ff;transform:translateY(-2px)}
    .letter-box.dragging{opacity:.5;transform:rotate(5deg)}
    .answer-area{margin-top:20px}
    .answer-box{width:45px;height:45px;border:3px solid #f2ac3b;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;color:#1c2d4f;background:#fefefe;min-height:45px;transition:.2s all}
    .answer-box.drop-zone{border-color:#4CAF50;background:#f0fff0}
    .answer-box.filled{background:#e8f5e8;border-color:#4CAF50}
    .check-btn{background:#1c2d4f;color:#fff;border:none;padding:12px 25px;border-radius:25px;font-family:'Schoulschreft',Arial,sans-serif;font-size:16px;cursor:pointer;margin-top:15px;transition:.3s all}
    .check-btn:hover{background:#2a3f6b;transform:translateY(-2px)}
    .result{margin-top:15px;font-size:18px;font-weight:bold;min-height:25px}
    .correct{color:#4CAF50}.incorrect{color:#f44336}
    .reset-btn{background:#f2ac3b;color:#1c2d4f;border:none;padding:8px 15px;border-radius:20px;font-family:'Schoulschreft',Arial,sans-serif;font-size:14px;cursor:pointer;margin-left:10px;transition:.3s all}
    .reset-btn:hover{background:#e09a2f}
    .navigation{display:flex;justify-content:space-between;align-items:center;margin-top:30px}
    .nav-btn{background:#1c2d4f;color:#fff;border:none;padding:12px 20px;border-radius:25px;font-family:'Schoulschreft',Arial,sans-serif;font-size:16px;cursor:pointer;transition:.3s all;min-width:120px}
    .nav-btn:hover:not(:disabled){background:#2a3f6b;transform:translateY(-2px)}
    .nav-btn:disabled{background:#ccc;cursor:not-allowed;opacity:.6}
    .completion-message{background:linear-gradient(135deg,#4CAF50,#45a049);color:#fff;padding:30px;border-radius:15px;margin-top:30px;font-size:24px;font-weight:bold;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.2)}
    @media (max-width:768px){
      .word-container{margin:0 10px;padding:25px}
      .header{font-size:22px;padding:15px}
      .letter-box,.answer-box{width:40px;height:40px;font-size:18px}
      .navigation{flex-direction:column;gap:15px}
      .nav-btn{width:100%}
    }
  </style>
</head>
<body>
  <div class="header">Setz d'Buschtawen an d√©i richteg Reiefolleg</div>

  <div class="container">
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="word-counter" id="wordCounter">Wuert 1 vun 6</div>
    <div class="word-container" id="currentWord"></div>

    <div class="navigation">
      <button class="nav-btn" id="prevBtn" onclick="previousWord()" disabled>‚Üê Zr√©ck</button>
      <button class="nav-btn" id="nextBtn" onclick="nextWord()" disabled>Weider ‚Üí</button>
    </div>

    <div class="completion-message" id="completionMessage" style="display:none;">
      üéâ Gratulatioun! Dir hutt all d'Wierder richteg geschriwwen! üéâ
    </div>
  </div>

  <!-- Shared audio -->
  <audio id="audio" preload="auto"></audio>

  <script>
    const words = [
      { correct:"KROUN", scrambled:["N","R","O","U","K"], image:"https://i.postimg.cc/2qbG0wH6/temp-Image-JCn-WDB.avif", pronunciation:"d'Kroun", audio:"https://github.com/albrechtclaire1007/trounwiessel/raw/refs/heads/main/M__kroun.mp3" },
      { correct:"TROUN", scrambled:["R","N","T","U","O"], image:"https://i.postimg.cc/HrP30Ktx/temp-Image-FUGbdk.avif", pronunciation:"den Troun", audio:"https://github.com/albrechtclaire1007/trounwiessel/raw/refs/heads/main/M__troun.mp3" },
      { correct:"GROUSSHERZOG", scrambled:["G","O","R","U","Z","H","R","O","S","S","E","G"], image:"https://i.postimg.cc/CZB7cNv5/temp-Image-JNo-Xc-R.avif", pronunciation:"de Groussherzog", audio:"https://github.com/albrechtclaire1007/trounwiessel/raw/refs/heads/main/M__groussherzog.mp3" },
      { correct:"ROUDEL√âIW", scrambled:["U","E","R","D","O","W","L","I","√â"], image:"https://i.postimg.cc/5HYgs3PQ/temp-Image-Dd-Tg-S4.avif", pronunciation:"de roude L√©iw", audio:"https://github.com/albrechtclaire1007/trounwiessel/raw/refs/heads/main/M__roude%20l%C3%A9iw.mp3" },
      { correct:"PALAIS", scrambled:["L","I","P","A","S","A"], image:"https://i.postimg.cc/sBQmTcnh/temp-Imageh35-I3-I.avif", pronunciation:"d'Palais", audio:"https://github.com/albrechtclaire1007/trounwiessel/raw/refs/heads/main/M__palais.mp3" },
      { correct:"SCHLASS", scrambled:["H","S","C","A","L","S","S"], image:"https://i.postimg.cc/7CG9KVBL/temp-Image-GM1j-Lo.avif", pronunciation:"d'Schlass", audio:"https://github.com/albrechtclaire1007/trounwiessel/raw/refs/heads/main/M__schlass.mp3" }
    ];

    let draggedElement = null, draggedFromContainer = null, currentWordIndex = 0, completedWords = new Set();
    const audioEl = document.getElementById('audio');

    function createWordBlock(word){
      return `
        <div class="image-container">
          <button class="audio-btn" onclick="playAudio()" title="Lauschteren" aria-label="Lauschteren">
            <svg class="speaker-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
            </svg>
          </button>
          <img src="${word.image}" alt="${word.pronunciation}" class="word-image"
               onerror="this.style.display='none';this.alt='Image failed to load'">
        </div>
        <div class="scrambled-letters" id="scrambled-current">
          ${word.scrambled.map((L,i)=>`<div class="letter-box" draggable="true" data-letter="${L}" data-index="${i}" role="button" aria-label="Buschtaw ${L}">${L}</div>`).join('')}
        </div>
        <div class="answer-area">
          <div class="answer-boxes" id="answer-current">
            ${Array(word.correct.length).fill('').map((_,i)=>`<div class="answer-box" data-position="${i}" role="button" aria-label="Plaz ${i+1}"></div>`).join('')}
          </div>
          <button class="check-btn" onclick="checkCurrentAnswer()">Kontroll√©ieren</button>
          <button class="reset-btn" onclick="resetCurrentWord()">Zr√©cksetzen</button>
          <div class="result" id="result-current"></div>
        </div>`;
    }

    function initializeGame(){
      showCurrentWord();
      updateProgress();
      updateNavigation();
    }

    function showCurrentWord(){
      const container = document.getElementById('currentWord');
      container.innerHTML = createWordBlock(words[currentWordIndex]);

      document.getElementById('wordCounter').textContent = `Wuert ${currentWordIndex+1} vun ${words.length}`;

      addDragDropListeners();
      addTapHandlers(); // <-- iPhone-friendly tap-to-place

      // Set and try autoplay audio
      const src = words[currentWordIndex].audio;
      if (audioEl.src !== src) audioEl.src = src;
      audioEl.play().catch(()=>{/* user gesture may be required */});
    }

    // ------- MOBILE TAP MODE -------
    function addTapHandlers(){
      // Tap letter -> fill next empty
      document.querySelectorAll('.letter-box').forEach(letterEl=>{
        letterEl.addEventListener('click', ()=>{
          const nextEmpty = [...document.querySelectorAll('#answer-current .answer-box')].find(b=>!b.textContent);
          if (!nextEmpty) return;
          nextEmpty.textContent = letterEl.dataset.letter;
          nextEmpty.classList.add('filled');
          letterEl.remove();
        }, {passive:true});
      });
      // Tap filled answer -> return letter
      document.querySelectorAll('#answer-current .answer-box').forEach(box=>{
        box.addEventListener('click', ()=>{
          if (!box.textContent) return;
          const L = box.textContent;
          const sc = document.getElementById('scrambled-current');
          const newBox = document.createElement('div');
          newBox.className='letter-box';
          newBox.draggable = true;
          newBox.dataset.letter = L;
          newBox.textContent = L;
          newBox.setAttribute('role','button');
          newBox.setAttribute('aria-label',`Buschtaw ${L}`);
          sc.appendChild(newBox);
          // rebind handlers on the newly created tile
          newBox.addEventListener('click', ()=>{
            const nextEmpty = [...document.querySelectorAll('#answer-current .answer-box')].find(b=>!b.textContent);
            if (!nextEmpty) return;
            nextEmpty.textContent = newBox.dataset.letter;
            nextEmpty.classList.add('filled');
            newBox.remove();
          }, {passive:true});
          newBox.addEventListener('dragstart', handleDragStart);
          newBox.addEventListener('dragend', handleDragEnd);

          box.textContent='';
          box.classList.remove('filled');
        }, {passive:true});
      });
    }

    // ------- DESKTOP DRAG & DROP -------
    function addDragDropListeners(){
      document.querySelectorAll('.letter-box').forEach(b=>{
        b.addEventListener('dragstart', handleDragStart);
        b.addEventListener('dragend', handleDragEnd);
      });
      document.querySelectorAll('.answer-box').forEach(box=>{
        box.addEventListener('dragover', e=>e.preventDefault());
        box.addEventListener('drop', handleDrop);
        box.addEventListener('dragenter', handleDragEnter);
        box.addEventListener('dragleave', handleDragLeave);
      });
      const scrambledArea = document.getElementById('scrambled-current');
      if (scrambledArea){
        scrambledArea.addEventListener('dragover', e=>e.preventDefault());
        scrambledArea.addEventListener('drop', handleDropToScrambled);
      }
    }

    function handleDragStart(e){
      draggedElement = e.target;
      draggedFromContainer = e.target.parentElement;
      e.target.classList.add('dragging');
    }
    function handleDragEnd(e){
      e.target.classList.remove('dragging');
      draggedElement = null; draggedFromContainer = null;
    }
    function handleDragEnter(e){
      if (e.target.classList.contains('answer-box') && !e.target.textContent){
        e.target.classList.add('drop-zone');
      }
    }
    function handleDragLeave(e){ e.target.classList.remove('drop-zone'); }
    function handleDrop(e){
      e.preventDefault();
      e.target.classList.remove('drop-zone');
      if (e.target.classList.contains('answer-box') && !e.target.textContent && draggedElement){
        e.target.textContent = draggedElement.dataset.letter;
        e.target.classList.add('filled');
        draggedElement.remove();
      }
    }
    function handleDropToScrambled(e){
      e.preventDefault();
      if (!draggedElement) return;
      const targetArea = document.getElementById('scrambled-current');
      const L = draggedElement.dataset.letter;
      const tile = document.createElement('div');
      tile.className='letter-box'; tile.draggable=true; tile.dataset.letter=L; tile.textContent=L;
      tile.setAttribute('role','button'); tile.setAttribute('aria-label',`Buschtaw ${L}`);
      targetArea.appendChild(tile);
      tile.addEventListener('dragstart', handleDragStart);
      tile.addEventListener('dragend', handleDragEnd);
      tile.addEventListener('click', ()=>{
        const nextEmpty = [...document.querySelectorAll('#answer-current .answer-box')].find(b=>!b.textContent);
        if (!nextEmpty) return;
        nextEmpty.textContent = tile.dataset.letter;
        nextEmpty.classList.add('filled');
        tile.remove();
      }, {passive:true});

      if (draggedFromContainer && draggedFromContainer.id === 'answer-current'){
        const answerBox = draggedElement.closest('.answer-box');
        if (answerBox){
          answerBox.textContent = '';
          answerBox.classList.remove('filled');
        }
      }
      draggedElement.remove();
    }

    function checkCurrentAnswer(){
      const answerBoxes = document.querySelectorAll('#answer-current .answer-box');
      const userAnswer = [...answerBoxes].map(b=>b.textContent).join('');
      const correctAnswer = words[currentWordIndex].correct;
      const resultDiv = document.getElementById('result-current');

      if (userAnswer === correctAnswer){
        resultDiv.textContent = '‚úì Richteg!';
        resultDiv.className = 'result correct';
        answerBoxes.forEach(b=>{ b.style.borderColor='#4CAF50'; b.style.background='#e8f5e8'; });
        completedWords.add(currentWordIndex);
        updateProgress(); updateNavigation();
        if (completedWords.size === words.length){
          setTimeout(()=>{ document.getElementById('completionMessage').style.display='block'; }, 600);
        }
      } else if (userAnswer.length === correctAnswer.length){
        resultDiv.textContent = '‚úó Prob√©ier nach emol!';
        resultDiv.className = 'result incorrect';
      } else {
        resultDiv.textContent = "Setz all d'Buschtawen!";
        resultDiv.className = 'result';
      }
    }

    function resetCurrentWord(){
      const answerBoxes = document.querySelectorAll('#answer-current .answer-box');
      answerBoxes.forEach(b=>{
        if (b.textContent){
          // return letters to scrambled
          const sc = document.getElementById('scrambled-current');
          const L = b.textContent;
          const tile = document.createElement('div');
          tile.className='letter-box'; tile.draggable=true; tile.dataset.letter=L; tile.textContent=L;
          tile.setAttribute('role','button'); tile.setAttribute('aria-label',`Buschtaw ${L}`);
          sc.appendChild(tile);
          tile.addEventListener('dragstart', handleDragStart);
          tile.addEventListener('dragend', handleDragEnd);
          tile.addEventListener('click', ()=>{
            const nextEmpty = [...document.querySelectorAll('#answer-current .answer-box')].find(x=>!x.textContent);
            if (!nextEmpty) return;
            nextEmpty.textContent = tile.dataset.letter;
            nextEmpty.classList.add('filled');
            tile.remove();
          }, {passive:true});
        }
        b.textContent=''; b.classList.remove('filled'); b.style.borderColor='#f2ac3b'; b.style.background='#fefefe';
      });
      document.getElementById('result-current').textContent=''; document.getElementById('result-current').className='result';
    }

    function nextWord(){
      if (currentWordIndex < words.length-1 && completedWords.has(currentWordIndex)){
        currentWordIndex++;
        showCurrentWord(); updateProgress(); updateNavigation();
      }
    }
    function previousWord(){
      if (currentWordIndex > 0){
        currentWordIndex--;
        showCurrentWord(); updateProgress(); updateNavigation();
      }
    }
    function updateProgress(){
      const pct = (completedWords.size / words.length) * 100;
      document.getElementById('progressFill').style.width = pct + '%';
      document.getElementById('wordCounter').textContent = `Wuert ${currentWordIndex+1} vun ${words.length}`;
    }
    function updateNavigation(){
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      prevBtn.disabled = currentWordIndex === 0;
      nextBtn.disabled = !completedWords.has(currentWordIndex) || currentWordIndex === words.length-1;
    }

    function playAudio(){
      audioEl.currentTime = 0;
      audioEl.play().catch(()=>{ /* tap will enable */ });
      // tiny toast
      const t=document.createElement('div');
      t.style.position='fixed';t.style.top='20px';t.style.right='20px';t.style.background='#1c2d4f';t.style.color='#fff';
      t.style.padding='8px 12px';t.style.borderRadius='8px';t.style.boxShadow='0 2px 10px rgba(0,0,0,.2)';t.style.fontSize='14px';
      t.textContent='üîä Lauschteren‚Ä¶';document.body.appendChild(t);setTimeout(()=>t.remove(),800);
    }

    document.addEventListener('DOMContentLoaded', initializeGame);
  </script>
</body>
</html>

